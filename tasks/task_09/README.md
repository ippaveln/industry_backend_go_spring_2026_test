# Практическое задание: Worker pool + context (generics)

В репозитории уже есть юнит-тесты. Ваша задача — написать реализацию, которая их проходит.

---

Сигнатура (не менять):


func ParallelMap[T any, R any](
    ctx context.Context,
    workers int,
    in []T,
    fn func(context.Context, T) (R, error),
) ([]R, error)


---

Требуемое поведение

1) Параллельная обработка с лимитом
- Нужно обработать каждый элемент in функцией fn.
- Одновременно должно выполняться не более workers вызовов fn.
- Нельзя создавать горутину на каждый элемент входа (должен быть worker pool).

2) Сохранение порядка
- Возвращаемый срез результатов должен соответствовать входному порядку:
  - результат для in[i] должен лежать в out[i],
  - даже если обработка завершается в другом порядке.

3) Отмена при первой ошибке
- Если любой вызов fn возвращает ошибку:
  - нужно отменить общий контекст (через context.WithCancel(ctx)),
  - прекратить запуск новых задач,
  - “лишнюю” работу остановить как можно раньше (запущенные fn должны увидеть отмену через переданный контекст),
  - вернуть ошибку.

4) Уважать отмену входного контекста
- Если ctx отменён, реализация не должна зависать.
- Ожидается корректный выход (обычно с ctx.Err()), если ошибка fn не произошла раньше.

5) Без утечек горутин
- После возврата ParallelMap не должно оставаться зависших горутин/воркеров/сборщиков.
- Косвенно проверяется тестами через гарантированное завершение.

---

Краевые случаи (ориентируйтесь на тесты)

- in == nil или len(in) == 0: вернуть пустой результат и nil-ошибку (если тесты не требуют иного).
- workers == 1: последовательная обработка с тем же контрактом.
- workers > len(in): допустимо, фактически параллелизм ограничится длиной входа.
- workers <= 0: поведение зависит от тестов (часто ожидается error). Если тесты уже заданы — под них и подстраивайтесь.

---

Ограничения

- Только стандартная библиотека.
- Нельзя “терять” результаты или нарушать порядок.
- Ошибка должна быть “первой” (как именно определено в тестах: первая по времени или первая по индексу — выясняется тестами; реализация обычно фиксирует первую фактически полученную ошибку и отменяет всё).


![task 09](../../badges/tasks/task_09.svg)

